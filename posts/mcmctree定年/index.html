<!DOCTYPE html>
<html lang="zh-CN"><meta charset="utf-8" />

  <title>mcmctree 定年 —— 使用氨基酸序列 - DeathSprout&#39;s Blog</title>


  <meta name="description" content="博客网站，我先搞他一搞" />

<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="stylesheet" href="https://deathsprout.gitee.io/css/latex.css" />
<link rel="stylesheet" href="https://deathsprout.gitee.io/css/main.css" />
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<meta name="generator" content="Hugo 0.82.0" /><body>






<header>
  <nav class="navbar">
  <div class="nav">
    

    <ul class="nav-links">
      
    </ul>
  </div>
</nav>
  <div class="intro-header">
    <div class="container">
      <div class="posts-heading">
        
          <h1>mcmctree 定年 —— 使用氨基酸序列</h1>
          
        
      </div>
    </div>
  </div>
</header>
<div id="content">
  <div class="container" role="main">
    <article class="article" class="blog-post">
      <div class="postmeta">
        <span class="meta-post">
  <i class="fa fa-calendar-alt"></i>May 25, 2021
  
    <br><i class="fa fa-folder-open"></i>
    
      <a href="https://deathsprout.gitee.io//categories/mcmctree/">mcmctree</a>&nbsp;
    
      <a href="https://deathsprout.gitee.io//categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF%E5%AD%A6/">生物信息学</a>&nbsp;
    
      <a href="https://deathsprout.gitee.io//categories/%E5%88%86%E5%AD%90%E5%AE%9A%E5%B9%B4/">分子定年</a>&nbsp;
    
      <a href="https://deathsprout.gitee.io//categories/%E8%B8%A9%E5%9D%91/">踩坑</a>&nbsp;
    
  
</span>
      </div>
      <br>
      
    <p>常见定年软件</p>
<ul>
<li>最大似然法：
<ul>
<li>r8s</li>
<li>Reltime</li>
</ul>
</li>
<li>贝叶斯法：
<ul>
<li>PAML-MCMCTree（PAML4软件包内含）</li>
<li>其他（Timetree）</li>
</ul>
</li>
</ul>
<p><a href="http://abacus.gene.ucl.ac.uk/software/MCMCtree.Tutorials.pdf">这里是mcmctree的手册</a></p>
<p>事先声明，mcmctree使用氨基酸序列进行定年比使用核酸序列麻烦的多，而且在此之前，能找到帖子的都语焉不详，手册里的Tutorial 4是主要参考，可以先跑一遍示例文件，坑主要是体现在文件格式上。</p>
<p>若使用氨基酸序列来进行分析，由于mcmctree不能选择较好的氨基酸替换模型进行分析，需要自己手动运行codeml进行分析后，在生成中间文件用于运行mcmctree。若非是因为数据原因必须用氨基酸序列进行定年，还是推荐使用核酸序列。</p>
<h3 id="前置">前置</h3>
<p>需求文件：(后面称其为那三个文件)</p>
<ul>
<li>多序列比对文件</li>
<li>带有校准信息有根树</li>
<li>控制文件 mcmctree.ctl</li>
</ul>
<p>前两个文件的格式很重要，参考examples里的abglobin.aa 和 abglobin.trees</p>
<p>
  <img src="https://gitee.com/deathsprout/giteeimage/raw/master/20210525143511.png" alt="">
</p>
<p>
  <img src="https://gitee.com/deathsprout/giteeimage/raw/master/20210525143609.png" alt="">
</p>
<p>树文件一定保证有至少一个时间校正点，&lsquo;B(1.7,1.9)&lsquo;的意思是最外面的这个分支点的时间，经化石证据矫正约束在170Mya到190Mya<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>年之间。</p>
<p>多序列对比文件第一行是：    序列数 序列长 （大写的）i
下面每行是一个序列名，和后面序列对应，序列名与序列之间的有空行，数字则是表明其下的序列们第一个位置是第几位。</p>
<p>我将fasta文件转变为phylip后，如下图所示，序列名并没有单独成行，它的格式并不能直接用，会报错。我也没找到合适的现有格式能方便的转换过去。
我参考的其他博客都是将其转化为phylip就能正常使用，唯一的区别是他们使用核酸序列而我用的是氨基酸序列，这是我踩的坑。</p>
<p>
  <img src="https://gitee.com/deathsprout/giteeimage/raw/master/20210525144314.png" alt="">
</p>
<p>数字不要紧，我在第一行后面加了个I后，除了第一行以外都能识别出，下面是识别过程的输出。

  <img src="https://gitee.com/deathsprout/giteeimage/raw/master/20210525144715.png" alt="">
</p>
<p>所以重点是将</p>
<p>G000238395 IVDLIDKVGL KDYQACCPFH NEKSPSFTVS QDKYHCFGCG ANGNAISFVM</p>
<p>G000263075 IVDLIDKVGL KDYQACCPFH NEKSPSFTVS QDKYHCFGCG ANGNAISFVM</p>
<p>这种形式变成下面那种形式</p>
<p>G000238395</p>
<p>G000263075</p>
<p>（空行）</p>
<p>IVDLIDKVGL KDYQACCPFH NEKSPSFTVS QDKYHCFGCG ANGNAISFVM</p>
<p>IVDLIDKVGL KDYQACCPFH NEKSPSFTVS QDKYHCFGCG ANGNAISFVM</p>
<p>数量大的话可以写个脚本，这里数量不多，用excel分割剪切出来，替换Tab键为空格再复制进去。</p>
<h3 id="流程">流程</h3>
<p>首先把那三个文件放在一个目录里，修改mcmctree文件，如下图红色部分所示。</p>
<p>
  <img src="https://gitee.com/deathsprout/giteeimage/raw/master/20210525150931.png" alt="">
</p>
<pre><code>seqfile  # 多序列比对文件
treefile  # 带有校准信息有根树
ndata   # 输入的多序列比对的数据个数，是密码子就是3；否则设置为1
seqtype = 2    * 0: nucleotides; 1:codons; 2:AAs #数据类型(2为氨基酸)
usedata = 1    * 0: no data; 1:seq like; 2:normal approximation; 3:out.BV (in.BV) # 设置是否利用多序列比对的数据：\
#0，表示不使用多序列比对数据，则不会进行likelihood计算，虽然能得到mcmc树且计算速度飞快，但是其分歧时间结果是有问题的；\
#1，表示使用多序列比对数据进行likelihood计算，正常进行MCMC，是一般使用的参数; \
#2，进行正常的approximation likelihood分析，此时不需要读取多序列比对数据，直接读取当前目录中的in.BV文件。该文件是使用usedata = 3参数生成的out.BV文件重命名而来的。\
#此外，由于程序BUG，当设置usedata = 2时，一定要在改行参数后加 *，否则程序报错 Error: file name empty.. \
#3，程序利用多序列比对数据调用baseml/codeml命令对数据进行分析，生成out.BV文件。由于mcmctree调用baseml/codeml进行计算的参数设置可能不太好（特别时对蛋白序列进行计算时），\
#推荐自己修改软件自动生成的baseml/codeml配置文件，然后再手动运行baseml/codeml命令，再整合其结果文件为out.BV文件。
</code></pre><p>运行</p>
<pre><code>mcmctree mcmctree.ctl
</code></pre><p>之后会生成一系列文件，删除out.BV和rst文件，将wag.dat拷贝进来，
打开文件tmp0001.ctl，全部替换为下列内容。</p>
<pre><code>seqfile = tmp0001.txt
treefile = tmp0001.trees
outfile = tmp0001.out
noisy = 3
seqtype = 2
model = 2 * 2: Empirical
aaRatefile = wag.dat
fix_alpha = 0
alpha = .5
ncatG = 4
Small_Diff = 0.1e-6
getSE = 2
method = 1
</code></pre><p>运行</p>
<pre><code>codeml tmp0001.ctl
</code></pre><p>这样就使用WAG+Gamma生成了适当的Hessian矩阵，接下来将rst2重命名为in.BV,现在可以更改mcmctree.ctl 的 usedata = 2</p>
<p>回到上一目录，新建一个文件夹，将 那三个文件和新生成的in.BV拷贝进去</p>
<p>接下来运行</p>
<pre><code>mcmctree mcmctree.ctl
</code></pre><p>后续与mcmctree无关</p>
<h3 id="参考">参考</h3>
<ul>
<li><a href="http://abacus.gene.ucl.ac.uk/software/MCMCtree.Tutorials.pdf">MCMCTree tutorials</a></li>
<li><a href="https://www.jianshu.com/p/46b28829b078">mcmctree估算物种分歧时间</a></li>
<li><a href="http://www.chenlianfu.com/?p=2974">使用PAML进行分歧时间计算</a></li>
</ul>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>Mya:百万年,mcmctree的单位是100个百万年 <a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>



      
        <div class="blog-tags">
          
            <a href="https://deathsprout.gitee.io//tags/mcmctree/">mcmctree</a>&nbsp;
          
            <a href="https://deathsprout.gitee.io//tags/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF%E5%AD%A6/">生物信息学</a>&nbsp;
          
            <a href="https://deathsprout.gitee.io//tags/%E5%88%86%E5%AD%90%E5%AE%9A%E5%B9%B4/">分子定年</a>&nbsp;
          
            <a href="https://deathsprout.gitee.io//tags/%E8%B8%A9%E5%9D%91/">踩坑</a>&nbsp;
          
        </div>
      
    </article>
    
  </div>

        </div><footer>
  <div class="container">
    <p class="credits copyright">
      <p class="credits theme-by">
        Powered By <a href="https://gohugo.io">Hugo</a>&nbsp;/&nbsp;Theme&nbsp;<a href="https://github.com/HelloRusk/HugoTeX">HugoTeX</a>
        <br>
        <a href="https://deathsprout.gitee.io/about">王子辰</a>
        &copy;
        2021
      </p>
  </div>
</footer></body>
</html>
